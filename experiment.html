<html>
    <head>
        <title>Artwork Selection Experiment</title> <!-- to fill in later -->
        <script src="jspsych-6.2.0/jspsych.js"></script>
        <script src="jspsych-6.2.0/plugins/jspsych-html-keyboard-response.js"> </script>
        <script src="jspsych-6.2.0/plugins/jspsych-image-keyboard-response.js"></script>
        <script src="jspsych-6.2.0/plugins/jspsych-image-button-response.js"></script>
        <script src="jspsych-6.2.0/plugins/jspsych-html-button-response.js"></script>
        <link href="jspsych-6.2.0/css/jspsych.css" rel="stylesheet" type="text/css">
    </head>
    <body></body>
    <script>
        /* constants to get started: */ 
        const numImages = 5; // the number of artworks displayed
        const payToCopy = 2; // amount you need to pay someone to copy their choices
        const rewardForCorrect = 10; // amount you get when you choose the right answer

        /* create timeline for experiment */ 
        let timeline = []; 

        /* define welcome message as a trial */
        let welcome = {
            type: "html-keyboard-response",
            stimulus: "Welcome to the experiment. Press any key to begin."
        }; 
        timeline.push(welcome); 

        // Randomly generates an integer between 1 and numImages to be the correct artwork. 
        function generateCorrectArtwork() { 
            let randomNum = (Math.random() * numImages) + 1; // random number between 1 and numImages
            return Math.floor(randomNum); // convert to integer
        }

        /* first step: art display */ 
            /* NOTE: jsPsych does define an image-button-response plugin, but this 
            seemed to be the easiest way to custom-display multiple images at once. */  
        let multiArtDisplay = {
            type: "html-button-response",
            stimulus: "<div><img src = 'images/img1.jpg'></img> </div>" + 
            "<div><img src = 'images/img2.jpg'></img> </div>" + 
            "<div><img src = 'images/img3.jpg'></img> </div>" + 
            "<div><img src = 'images/img4.jpg'></img> </div>" + 
            "<div><img src = 'images/img5.jpg'></img> </div>",
            prompt: "Please select what you think is the <strong> highest-value </strong> artwork.",
            choices: [1, 2, 3, 4, 5], 
            data: {correct: generateCorrectArtwork()}
        };
        timeline.push(multiArtDisplay);

        // Returns the button selected in previous trial (should be integer between 1 and 5)
        function getArtWorkSelected() { 
            /* jsPsych.data returns a DataCollection object. Using .select('button_pressed') gives you a 
            DataColumn object. Using .values gives you an array of all values for button_pressed. 
            In this case, there is only one button_pressed and therefore we use [0] to grab that. */
            let offByOne = jsPsych.data.getLastTrialData().select('button_pressed').values[0]; 
            // button_pressed stores the first button as 0; I started labeling at 1. This does conversion.
            return offByOne + 1; 
        }; 

        // Returns what the correct answer was in the previous trial (useful because it's randomized)
        function getCorrectArtwork () { 
            return jsPsych.data.getLastTrialData().select('correct').values[0];
        }

        // Returns whether the answer in the previous trial was correct (should be boolean)
        function isAnswerCorrect() { 
            let artSelected = getArtWorkSelected(); 
            let correctAnswer = jsPsych.data.getLastTrialData().select('correct').values[0];
            return (artSelected === correctAnswer); 
        }

        let displayResults = { 
            type: "html-button-response",
            stimulus: function () { 
                let response = "Your choice was button number " + getArtWorkSelected() + ". \n"; 
                if (isAnswerCorrect()) 
                    return response + `Your answer is correct. You earned $${rewardForCorrect}.`; 
                else 
                    return response + "Your answer is incorrect. The correct value was: " + getCorrectArtwork() + "."; 
            }, 
            choices: ["Continue"]
        }
        timeline.push(displayResults);

        let chooseToCopy = { 
            type: "html-button-response",
            stimulus: "Here are the other players' results. PLACEHOLDER! <br> </br> In the next round, " + 
            `you may either choose the highest-value artwork on your own or pay another player $${payToCopy} to copy their choice. <br> </br> <br> </br>`,
            prompt: "Which player would you like to copy?", 
            choices: ["None, I would like to make my own choice.", "Player 1", "Player 2", "Player 3", "Player 4"]
        }
        timeline.push(chooseToCopy);

        /* End of experiment page as trial */ 
        let goodbye = { 
            type: "html-keyboard-response", 
            stimulus: "Thanks for participating. The experiment is over. You can close the browser window.",
            choices: jsPsych.NO_KEYS, 
            trial_duration: 2000 // Remove this when not debugging (need this line for displayData())
        };
        timeline.push(goodbye);  

        /* start the experiment */ 
        jsPsych.init({
            timeline: timeline, 
            on_finish: function () {
                // For debugging purposes:  
                console.log("started"); 
                jsPsych.data.displayData();
                // console.log(jsPsych.data.getLastTimelineData().select('button_pressed').values[0]);
            }
        }); 
        
    </script>
</html>